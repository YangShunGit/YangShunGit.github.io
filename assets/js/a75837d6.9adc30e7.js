"use strict";(self.webpackChunkys_blog=self.webpackChunkys_blog||[]).push([[1560],{5326:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"\u6e90\u7801\u5206\u6790/webpack/\u81ea\u5b9a\u4e49plugin","title":"\u81ea\u5b9a\u4e49plugin","description":"\u81ea\u5b9a\u4e49 Webpack Plugin \u662f\u6269\u5c55 Webpack \u529f\u80fd\u7684\u5f3a\u5927\u65b9\u5f0f\uff0c\u5b83\u5141\u8bb8\u4f60\u5728\u6784\u5efa\u6d41\u7a0b\u7684\u7279\u5b9a\u9636\u6bb5\u6267\u884c\u81ea\u5b9a\u4e49\u903b\u8f91\u3002\u4ee5\u4e0b\u4ece\u57fa\u7840\u7ed3\u6784\u3001\u6838\u5fc3\u539f\u7406\u5230\u5b9e\u6218\u6848\u4f8b\uff0c\u5168\u9762\u89e3\u6790\u5982\u4f55\u5f00\u53d1\u81ea\u5b9a\u4e49 Plugin\uff1a","source":"@site/frontend/\u6e90\u7801\u5206\u6790/webpack/\u81ea\u5b9a\u4e49plugin.md","sourceDirName":"\u6e90\u7801\u5206\u6790/webpack","slug":"/\u6e90\u7801\u5206\u6790/webpack/\u81ea\u5b9a\u4e49plugin","permalink":"/frontend/\u6e90\u7801\u5206\u6790/webpack/\u81ea\u5b9a\u4e49plugin","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/frontend/\u6e90\u7801\u5206\u6790/webpack/\u81ea\u5b9a\u4e49plugin.md","tags":[],"version":"current","frontMatter":{},"sidebar":"frontend","previous":{"title":"\u81ea\u5b9a\u4e49loader","permalink":"/frontend/\u6e90\u7801\u5206\u6790/webpack/\u81ea\u5b9a\u4e49loader"}}');var l=s(4848),r=s(8453);const o={},c=void 0,t={},d=[{value:"<strong>1. Plugin \u57fa\u7840\u7ed3\u6784</strong>",id:"1-plugin-\u57fa\u7840\u7ed3\u6784",level:3},{value:"<strong>2. \u6838\u5fc3\u539f\u7406\uff1aTapable \u94a9\u5b50\u7cfb\u7edf</strong>",id:"2-\u6838\u5fc3\u539f\u7406tapable-\u94a9\u5b50\u7cfb\u7edf",level:3},{value:"<strong>\u94a9\u5b50\u7c7b\u578b</strong>",id:"\u94a9\u5b50\u7c7b\u578b",level:4},{value:"<strong>\u5e38\u89c1\u94a9\u5b50</strong>",id:"\u5e38\u89c1\u94a9\u5b50",level:4},{value:"<strong>3. \u5f00\u53d1\u5b9e\u6218\uff1a\u6587\u4ef6\u538b\u7f29 Plugin</strong>",id:"3-\u5f00\u53d1\u5b9e\u6218\u6587\u4ef6\u538b\u7f29-plugin",level:3},{value:"<strong>\u9700\u6c42</strong>\uff1a\u5728\u6587\u4ef6\u8f93\u51fa\u524d\u538b\u7f29 JS \u6587\u4ef6",id:"\u9700\u6c42\u5728\u6587\u4ef6\u8f93\u51fa\u524d\u538b\u7f29-js-\u6587\u4ef6",level:4},{value:"<strong>4. \u8bbf\u95ee\u548c\u4fee\u6539\u6a21\u5757/\u8d44\u6e90</strong>",id:"4-\u8bbf\u95ee\u548c\u4fee\u6539\u6a21\u5757\u8d44\u6e90",level:3},{value:"<strong>\uff081\uff09\u8bbf\u95ee\u6a21\u5757\u4fe1\u606f</strong>",id:"1\u8bbf\u95ee\u6a21\u5757\u4fe1\u606f",level:4},{value:"<strong>\uff082\uff09\u4fee\u6539\u8f93\u51fa\u8d44\u6e90</strong>",id:"2\u4fee\u6539\u8f93\u51fa\u8d44\u6e90",level:4},{value:"<strong>5. \u9ad8\u7ea7\u6280\u5de7</strong>",id:"5-\u9ad8\u7ea7\u6280\u5de7",level:3},{value:"<strong>\uff081\uff09\u5f02\u6b65\u94a9\u5b50\u5904\u7406</strong>",id:"1\u5f02\u6b65\u94a9\u5b50\u5904\u7406",level:4},{value:"<strong>\uff082\uff09\u9519\u8bef\u5904\u7406</strong>",id:"2\u9519\u8bef\u5904\u7406",level:4},{value:"<strong>\uff083\uff09\u591a Compiler \u652f\u6301</strong>",id:"3\u591a-compiler-\u652f\u6301",level:4},{value:"<strong>6. \u8c03\u8bd5\u4e0e\u6d4b\u8bd5</strong>",id:"6-\u8c03\u8bd5\u4e0e\u6d4b\u8bd5",level:3},{value:"<strong>\uff081\uff09\u8c03\u8bd5\u6280\u5de7</strong>",id:"1\u8c03\u8bd5\u6280\u5de7",level:4},{value:"<strong>\uff082\uff09\u5355\u5143\u6d4b\u8bd5</strong>",id:"2\u5355\u5143\u6d4b\u8bd5",level:4},{value:"<strong>7. \u5e38\u89c1 Plugin \u573a\u666f</strong>",id:"7-\u5e38\u89c1-plugin-\u573a\u666f",level:3},{value:"<strong>\uff081\uff09\u751f\u6210 HTML \u6587\u4ef6</strong>",id:"1\u751f\u6210-html-\u6587\u4ef6",level:4},{value:"<strong>\uff082\uff09\u6e05\u7406\u6784\u5efa\u76ee\u5f55</strong>",id:"2\u6e05\u7406\u6784\u5efa\u76ee\u5f55",level:4},{value:"<strong>8. \u53d1\u5e03\u4e0e\u7ef4\u62a4</strong>",id:"8-\u53d1\u5e03\u4e0e\u7ef4\u62a4",level:3},{value:"<strong>9. \u9762\u8bd5\u9ad8\u9891\u95ee\u9898</strong>",id:"9-\u9762\u8bd5\u9ad8\u9891\u95ee\u9898",level:3}];function a(n){const e={br:"br",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.p,{children:"\u81ea\u5b9a\u4e49 Webpack Plugin \u662f\u6269\u5c55 Webpack \u529f\u80fd\u7684\u5f3a\u5927\u65b9\u5f0f\uff0c\u5b83\u5141\u8bb8\u4f60\u5728\u6784\u5efa\u6d41\u7a0b\u7684\u7279\u5b9a\u9636\u6bb5\u6267\u884c\u81ea\u5b9a\u4e49\u903b\u8f91\u3002\u4ee5\u4e0b\u4ece\u57fa\u7840\u7ed3\u6784\u3001\u6838\u5fc3\u539f\u7406\u5230\u5b9e\u6218\u6848\u4f8b\uff0c\u5168\u9762\u89e3\u6790\u5982\u4f55\u5f00\u53d1\u81ea\u5b9a\u4e49 Plugin\uff1a"}),"\n",(0,l.jsx)(e.h3,{id:"1-plugin-\u57fa\u7840\u7ed3\u6784",children:(0,l.jsx)(e.strong,{children:"1. Plugin \u57fa\u7840\u7ed3\u6784"})}),"\n",(0,l.jsxs)(e.p,{children:["Webpack Plugin \u662f\u4e00\u4e2a",(0,l.jsxs)(e.strong,{children:["\u5e26\u6709 ",(0,l.jsx)(e.code,{children:"apply"})," \u65b9\u6cd5\u7684\u7c7b"]}),"\uff0c\u8be5\u65b9\u6cd5\u4f1a\u5728 Webpack \u542f\u52a8\u65f6\u88ab\u8c03\u7528\uff0c\u5e76\u4f20\u5165 ",(0,l.jsx)(e.code,{children:"compiler"})," \u5bf9\u8c61\u3002"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u6700\u7b80 Plugin \u793a\u4f8b"}),"\uff08\u6784\u5efa\u5b8c\u6210\u540e\u6253\u5370\u65e5\u5fd7\uff09\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"class BuildEndPlugin {\n  constructor(options) {\n    this.options = options;\n  }\n\n  apply(compiler) {\n    // \u76d1\u542c 'done' \u94a9\u5b50\uff0c\u5728\u6784\u5efa\u5b8c\u6210\u540e\u6267\u884c\n    compiler.hooks.done.tap('BuildEndPlugin', stats => {\n      console.log(`\u2728 \u6784\u5efa\u5b8c\u6210\uff01\u8017\u65f6\uff1a${stats.endTime - stats.startTime}ms`);\n    });\n  }\n}\n\nmodule.exports = BuildEndPlugin;\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u914d\u7f6e\u4f7f\u7528"}),"\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"// webpack.config.js\nconst BuildEndPlugin = require('./BuildEndPlugin');\n\nmodule.exports = {\n  plugins: [\n    new BuildEndPlugin({ /* \u914d\u7f6e\u9009\u9879 */ })\n  ]\n};\n"})}),"\n",(0,l.jsx)(e.h3,{id:"2-\u6838\u5fc3\u539f\u7406tapable-\u94a9\u5b50\u7cfb\u7edf",children:(0,l.jsx)(e.strong,{children:"2. \u6838\u5fc3\u539f\u7406\uff1aTapable \u94a9\u5b50\u7cfb\u7edf"})}),"\n",(0,l.jsxs)(e.p,{children:["Webpack \u901a\u8fc7 ",(0,l.jsx)(e.strong,{children:"Tapable"})," \u5e93\u5b9e\u73b0\u4e8b\u4ef6\u94a9\u5b50\u673a\u5236\uff0cPlugin \u901a\u8fc7\u76d1\u542c\u7279\u5b9a\u94a9\u5b50\u6765\u4ecb\u5165\u6784\u5efa\u6d41\u7a0b\uff1a"]}),"\n",(0,l.jsx)(e.h4,{id:"\u94a9\u5b50\u7c7b\u578b",children:(0,l.jsx)(e.strong,{children:"\u94a9\u5b50\u7c7b\u578b"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u540c\u6b65\u94a9\u5b50"}),"\uff1a",(0,l.jsx)(e.code,{children:"tap"}),"\uff08\u666e\u901a\u540c\u6b65\uff09\u3001",(0,l.jsx)(e.code,{children:"tapPromise"}),"\uff08Promise \u5f02\u6b65\uff09"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5f02\u6b65\u94a9\u5b50"}),"\uff1a",(0,l.jsx)(e.code,{children:"tapAsync"}),"\uff08\u56de\u8c03\u5f02\u6b65\uff09\u3001",(0,l.jsx)(e.code,{children:"tapPromise"}),"\uff08Promise \u5f02\u6b65\uff09"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"\u5e38\u89c1\u94a9\u5b50",children:(0,l.jsx)(e.strong,{children:"\u5e38\u89c1\u94a9\u5b50"})}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u94a9\u5b50\u540d\u79f0"}),(0,l.jsx)(e.th,{children:"\u89e6\u53d1\u65f6\u673a"}),(0,l.jsx)(e.th,{children:"\u7c7b\u578b"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"compiler.hooks.entryOption"})}),(0,l.jsx)(e.td,{children:"\u89e3\u6790\u5165\u53e3\u914d\u7f6e\u540e"}),(0,l.jsx)(e.td,{children:"\u540c\u6b65"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"compiler.hooks.beforeRun"})}),(0,l.jsx)(e.td,{children:"\u5f00\u59cb\u7f16\u8bd1\u524d"}),(0,l.jsx)(e.td,{children:"\u5f02\u6b65"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"compilation.hooks.optimize"})}),(0,l.jsx)(e.td,{children:"\u4f18\u5316\u6a21\u5757\u65f6"}),(0,l.jsx)(e.td,{children:"\u540c\u6b65"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"compiler.hooks.emit"})}),(0,l.jsx)(e.td,{children:"\u751f\u6210\u6587\u4ef6\u5230\u8f93\u51fa\u76ee\u5f55\u524d"}),(0,l.jsx)(e.td,{children:"\u5f02\u6b65"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:(0,l.jsx)(e.code,{children:"compiler.hooks.done"})}),(0,l.jsx)(e.td,{children:"\u6784\u5efa\u5b8c\u6210\u540e"}),(0,l.jsx)(e.td,{children:"\u540c\u6b65"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"3-\u5f00\u53d1\u5b9e\u6218\u6587\u4ef6\u538b\u7f29-plugin",children:(0,l.jsx)(e.strong,{children:"3. \u5f00\u53d1\u5b9e\u6218\uff1a\u6587\u4ef6\u538b\u7f29 Plugin"})}),"\n",(0,l.jsxs)(e.h4,{id:"\u9700\u6c42\u5728\u6587\u4ef6\u8f93\u51fa\u524d\u538b\u7f29-js-\u6587\u4ef6",children:[(0,l.jsx)(e.strong,{children:"\u9700\u6c42"}),"\uff1a\u5728\u6587\u4ef6\u8f93\u51fa\u524d\u538b\u7f29 JS \u6587\u4ef6"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"const { minify } = require('terser');\n\nclass MinifyPlugin {\n  constructor(options = {}) {\n    this.options = options;\n  }\n\n  apply(compiler) {\n    // \u76d1\u542c emit \u94a9\u5b50\uff0c\u6b64\u65f6\u6587\u4ef6\u5c1a\u672a\u5199\u5165\u78c1\u76d8\n    compiler.hooks.emit.tapAsync('MinifyPlugin', (compilation, callback) => {\n      // \u83b7\u53d6\u6240\u6709\u8f93\u51fa\u6587\u4ef6\n      const assets = compilation.assets;\n      const assetNames = Object.keys(assets);\n\n      // \u904d\u5386\u5904\u7406\u6bcf\u4e2a JS \u6587\u4ef6\n      const tasks = assetNames.map(assetName => {\n        if (!assetName.endsWith('.js')) return;\n\n        const source = assets[assetName].source(); // \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9\n        \n        return minify(source, this.options).then(minified => {\n          // \u66f4\u65b0\u6587\u4ef6\u5185\u5bb9\n          assets[assetName] = {\n            source: () => minified.code,\n            size: () => minified.code.length\n          };\n        });\n      });\n\n      // \u7b49\u5f85\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u540e\u7ee7\u7eed\n      Promise.all(tasks).then(() => callback()).catch(err => callback(err));\n    });\n  }\n}\n\nmodule.exports = MinifyPlugin;\n"})}),"\n",(0,l.jsx)(e.h3,{id:"4-\u8bbf\u95ee\u548c\u4fee\u6539\u6a21\u5757\u8d44\u6e90",children:(0,l.jsx)(e.strong,{children:"4. \u8bbf\u95ee\u548c\u4fee\u6539\u6a21\u5757/\u8d44\u6e90"})}),"\n",(0,l.jsxs)(e.p,{children:["Plugin \u53ef\u4ee5\u901a\u8fc7 ",(0,l.jsx)(e.code,{children:"compilation"})," \u5bf9\u8c61\u8bbf\u95ee\u548c\u4fee\u6539\u6a21\u5757\u3001\u4f9d\u8d56\u53ca\u8f93\u51fa\u8d44\u6e90\uff1a"]}),"\n",(0,l.jsx)(e.h4,{id:"1\u8bbf\u95ee\u6a21\u5757\u4fe1\u606f",children:(0,l.jsx)(e.strong,{children:"\uff081\uff09\u8bbf\u95ee\u6a21\u5757\u4fe1\u606f"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"compiler.hooks.compilation.tap('MyPlugin', compilation => {\n  // \u904d\u5386\u6240\u6709\u6a21\u5757\n  compilation.modules.forEach(module => {\n    console.log(`\u6a21\u5757: ${module.resource}`);\n  });\n});\n"})}),"\n",(0,l.jsx)(e.h4,{id:"2\u4fee\u6539\u8f93\u51fa\u8d44\u6e90",children:(0,l.jsx)(e.strong,{children:"\uff082\uff09\u4fee\u6539\u8f93\u51fa\u8d44\u6e90"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"compiler.hooks.emit.tap('MyPlugin', compilation => {\n  // \u6dfb\u52a0\u65b0\u6587\u4ef6\n  compilation.assets['new-file.txt'] = {\n    source: () => '\u8fd9\u662f\u4e00\u4e2a\u65b0\u6587\u4ef6',\n    size: () => 15\n  };\n\n  // \u4fee\u6539\u73b0\u6709\u6587\u4ef6\n  if (compilation.assets['main.js']) {\n    const original = compilation.assets['main.js'].source();\n    compilation.assets['main.js'] = {\n      source: () => original + '\\n// \u8ffd\u52a0\u5185\u5bb9',\n      size: () => original.length + 12\n    };\n  }\n});\n"})}),"\n",(0,l.jsx)(e.h3,{id:"5-\u9ad8\u7ea7\u6280\u5de7",children:(0,l.jsx)(e.strong,{children:"5. \u9ad8\u7ea7\u6280\u5de7"})}),"\n",(0,l.jsx)(e.h4,{id:"1\u5f02\u6b65\u94a9\u5b50\u5904\u7406",children:(0,l.jsx)(e.strong,{children:"\uff081\uff09\u5f02\u6b65\u94a9\u5b50\u5904\u7406"})}),"\n",(0,l.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"tapPromise"})," \u5904\u7406\u5f02\u6b65\u64cd\u4f5c\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"compiler.hooks.emit.tapPromise('MyPlugin', compilation => {\n  return new Promise((resolve, reject) => {\n    // \u5f02\u6b65\u64cd\u4f5c...\n    setTimeout(() => {\n      // \u5b8c\u6210\u540e resolve\n      resolve();\n    }, 1000);\n  });\n});\n"})}),"\n",(0,l.jsx)(e.h4,{id:"2\u9519\u8bef\u5904\u7406",children:(0,l.jsx)(e.strong,{children:"\uff082\uff09\u9519\u8bef\u5904\u7406"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"compiler.hooks.thisCompilation.tap('MyPlugin', compilation => {\n  // \u6dfb\u52a0\u7f16\u8bd1\u9519\u8bef\n  compilation.errors.push(new Error('\u8fd9\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u9519\u8bef'));\n});\n"})}),"\n",(0,l.jsx)(e.h4,{id:"3\u591a-compiler-\u652f\u6301",children:(0,l.jsx)(e.strong,{children:"\uff083\uff09\u591a Compiler \u652f\u6301"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"class MultiCompilerPlugin {\n  apply(multiCompiler) {\n    multiCompiler.compilers.forEach(compiler => {\n      // \u4e3a\u6bcf\u4e2a compiler \u6ce8\u518c\u94a9\u5b50\n      compiler.hooks.done.tap('MultiCompilerPlugin', () => {\n        console.log(`Compiler ${compiler.name} \u5b8c\u6210`);\n      });\n    });\n  }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"6-\u8c03\u8bd5\u4e0e\u6d4b\u8bd5",children:(0,l.jsx)(e.strong,{children:"6. \u8c03\u8bd5\u4e0e\u6d4b\u8bd5"})}),"\n",(0,l.jsx)(e.h4,{id:"1\u8c03\u8bd5\u6280\u5de7",children:(0,l.jsx)(e.strong,{children:"\uff081\uff09\u8c03\u8bd5\u6280\u5de7"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"console.log"})," \u8f93\u51fa\u5173\u952e\u4fe1\u606f"]}),"\n",(0,l.jsxs)(e.li,{children:["\u901a\u8fc7 ",(0,l.jsx)(e.code,{children:"debug"})," \u6a21\u5757\u6dfb\u52a0\u8c03\u8bd5\u65e5\u5fd7"]}),"\n",(0,l.jsxs)(e.li,{children:["\u5728 Webpack \u914d\u7f6e\u4e2d\u6dfb\u52a0 ",(0,l.jsx)(e.code,{children:"--debug"})," \u53c2\u6570"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"2\u5355\u5143\u6d4b\u8bd5",children:(0,l.jsx)(e.strong,{children:"\uff082\uff09\u5355\u5143\u6d4b\u8bd5"})}),"\n",(0,l.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"jest"})," \u6216 ",(0,l.jsx)(e.code,{children:"mocha"})," \u6d4b\u8bd5 Plugin\uff1a"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"const { Compiler, Compilation } = require('webpack');\nconst MyPlugin = require('./MyPlugin');\n\ndescribe('MyPlugin', () => {\n  it('should add a banner', () => {\n    const compiler = new Compiler();\n    const plugin = new MyPlugin({ banner: 'Test Banner' });\n    \n    // \u6a21\u62df compilation\n    const compilation = new Compilation(compiler);\n    jest.spyOn(compilation, 'fileDependencies');\n    \n    // \u5e94\u7528\u63d2\u4ef6\n    plugin.apply(compiler);\n    compiler.hooks.emit.callAsync(compilation, () => {\n      // \u65ad\u8a00...\n    });\n  });\n});\n"})}),"\n",(0,l.jsx)(e.h3,{id:"7-\u5e38\u89c1-plugin-\u573a\u666f",children:(0,l.jsx)(e.strong,{children:"7. \u5e38\u89c1 Plugin \u573a\u666f"})}),"\n",(0,l.jsx)(e.h4,{id:"1\u751f\u6210-html-\u6587\u4ef6",children:(0,l.jsx)(e.strong,{children:"\uff081\uff09\u751f\u6210 HTML \u6587\u4ef6"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"class HtmlGeneratorPlugin {\n  apply(compiler) {\n    compiler.hooks.emit.tap('HtmlGeneratorPlugin', compilation => {\n      const html = `\n        <!DOCTYPE html>\n        <html>\n          <body>\n            <script src=\"main.js\"><\/script>\n          </body>\n        </html>\n      `;\n      \n      compilation.assets['index.html'] = {\n        source: () => html,\n        size: () => html.length\n      };\n    });\n  }\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"2\u6e05\u7406\u6784\u5efa\u76ee\u5f55",children:(0,l.jsx)(e.strong,{children:"\uff082\uff09\u6e05\u7406\u6784\u5efa\u76ee\u5f55"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-javascript",children:"const fs = require('fs');\nconst path = require('path');\n\nclass CleanPlugin {\n  constructor(options = {}) {\n    this.options = options;\n  }\n\n  apply(compiler) {\n    compiler.hooks.beforeRun.tap('CleanPlugin', () => {\n      const outputPath = compiler.options.output.path;\n      \n      // \u5220\u9664\u76ee\u5f55\u5185\u5bb9\n      fs.readdirSync(outputPath).forEach(file => {\n        const filePath = path.join(outputPath, file);\n        fs.unlinkSync(filePath);\n      });\n    });\n  }\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"8-\u53d1\u5e03\u4e0e\u7ef4\u62a4",children:(0,l.jsx)(e.strong,{children:"8. \u53d1\u5e03\u4e0e\u7ef4\u62a4"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsxs)(e.strong,{children:["\u7f16\u5199 ",(0,l.jsx)(e.code,{children:"package.json"})]}),"\uff1a\u6307\u5b9a\u5165\u53e3\u6587\u4ef6\u3001\u7248\u672c\u7b49"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u6dfb\u52a0 TypeScript \u652f\u6301"}),"\uff08\u5982\u679c\u9700\u8981\uff09"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5b8c\u5584\u6587\u6863"}),"\uff1a\u8bf4\u660e\u529f\u80fd\u3001\u914d\u7f6e\u9009\u9879\u548c\u4f7f\u7528\u793a\u4f8b"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.strong,{children:"\u9075\u5faa SemVer \u7248\u672c\u89c4\u8303"})}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"9-\u9762\u8bd5\u9ad8\u9891\u95ee\u9898",children:(0,l.jsx)(e.strong,{children:"9. \u9762\u8bd5\u9ad8\u9891\u95ee\u9898"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Loader \u548c Plugin \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["Loader\uff1a\u5904\u7406\u7279\u5b9a\u7c7b\u578b\u7684\u6587\u4ef6\uff08\u5982 ",(0,l.jsx)(e.code,{children:".css"}),"\u3001",(0,l.jsx)(e.code,{children:".js"}),"\uff09\u3002"]}),"\n",(0,l.jsx)(e.li,{children:"Plugin\uff1a\u57fa\u4e8e\u4e8b\u4ef6\u94a9\u5b50\uff0c\u5728\u6784\u5efa\u6d41\u7a0b\u7684\u7279\u5b9a\u9636\u6bb5\u6267\u884c\u81ea\u5b9a\u4e49\u903b\u8f91\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u5982\u4f55\u5728 Plugin \u4e2d\u76d1\u542c\u5f02\u6b65\u94a9\u5b50\uff1f"}),(0,l.jsx)(e.br,{}),"\n","\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"tapAsync"}),"\uff08\u56de\u8c03\u65b9\u5f0f\uff09\u6216 ",(0,l.jsx)(e.code,{children:"tapPromise"}),"\uff08Promise \u65b9\u5f0f\uff09\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsxs)(e.strong,{children:[(0,l.jsx)(e.code,{children:"compiler"})," \u548c ",(0,l.jsx)(e.code,{children:"compilation"})," \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f"]})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"compiler"}),"\uff1a\u5168\u5c40\u5355\u4f8b\uff0c\u5305\u542b Webpack \u73af\u5883\u7684\u6240\u6709\u914d\u7f6e\u4fe1\u606f\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"compilation"}),"\uff1a\u6bcf\u6b21\u6784\u5efa\u7684\u4e0a\u4e0b\u6587\uff0c\u5305\u542b\u5f53\u524d\u6a21\u5757\u3001\u4f9d\u8d56\u548c\u8f93\u51fa\u6587\u4ef6\u4fe1\u606f\u3002"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>c});var i=s(6540);const l={},r=i.createContext(l);function o(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);