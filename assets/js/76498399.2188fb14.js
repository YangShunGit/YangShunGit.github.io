"use strict";(self.webpackChunkys_blog=self.webpackChunkys_blog||[]).push([[6568],{3619:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"\u6d4f\u89c8\u5668/http/SEE\u534f\u8bae","title":"SEE\u534f\u8bae","description":"Server-Sent Events\uff08SEE\uff09\u662f\u4e00\u79cd\u57fa\u4e8eHTTP\u534f\u8bae\u7684\u8f7b\u91cf\u7ea7\u670d\u52a1\u5668\u63a8\u9001\u6280\u672f\uff0c\u5176\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\u53ef\u4ee5\u6982\u62ec\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6838\u5fc3\u8981\u70b9\uff1a","source":"@site/frontend/\u6d4f\u89c8\u5668/http/SEE\u534f\u8bae.md","sourceDirName":"\u6d4f\u89c8\u5668/http","slug":"/\u6d4f\u89c8\u5668/http/SEE\u534f\u8bae","permalink":"/frontend/\u6d4f\u89c8\u5668/http/SEE\u534f\u8bae","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/frontend/\u6d4f\u89c8\u5668/http/SEE\u534f\u8bae.md","tags":[],"version":"current","frontMatter":{},"sidebar":"frontend","previous":{"title":"http\u8d44\u6e90\u538b\u7f29","permalink":"/frontend/\u6d4f\u89c8\u5668/http/http\u8d44\u6e90\u538b\u7f29"},"next":{"title":"cookie","permalink":"/frontend/\u6d4f\u89c8\u5668/http/cookie"}}');var t=r(4848),l=r(8453);const d={},i=void 0,c={},o=[{value:"<strong>1. \u57fa\u4e8eHTTP\u957f\u8fde\u63a5\u7684\u5355\u5411\u901a\u4fe1</strong>",id:"1-\u57fa\u4e8ehttp\u957f\u8fde\u63a5\u7684\u5355\u5411\u901a\u4fe1",level:3},{value:"<strong>\u5de5\u4f5c\u6d41\u7a0b</strong>",id:"\u5de5\u4f5c\u6d41\u7a0b",level:4},{value:"<strong>2. \u6570\u636e\u683c\u5f0f\uff1aEvent Stream</strong>",id:"2-\u6570\u636e\u683c\u5f0fevent-stream",level:3},{value:"<strong>\u793a\u4f8b</strong>",id:"\u793a\u4f8b",level:4},{value:"<strong>3. \u81ea\u52a8\u91cd\u8fde\u673a\u5236</strong>",id:"3-\u81ea\u52a8\u91cd\u8fde\u673a\u5236",level:3},{value:"<strong>4. \u5ba2\u6237\u7aef\u5b9e\u73b0\uff08JavaScript\uff09</strong>",id:"4-\u5ba2\u6237\u7aef\u5b9e\u73b0javascript",level:3},{value:"<strong>5. \u670d\u52a1\u5668\u5b9e\u73b0\u793a\u4f8b</strong>",id:"5-\u670d\u52a1\u5668\u5b9e\u73b0\u793a\u4f8b",level:3},{value:"<strong>6. \u4e0eWebSocket\u7684\u6838\u5fc3\u5dee\u5f02</strong>",id:"6-\u4e0ewebsocket\u7684\u6838\u5fc3\u5dee\u5f02",level:3},{value:"<strong>7. \u5c40\u9650\u6027\u4e0e\u9002\u7528\u573a\u666f</strong>",id:"7-\u5c40\u9650\u6027\u4e0e\u9002\u7528\u573a\u666f",level:3},{value:"<strong>\u5c40\u9650\u6027</strong>",id:"\u5c40\u9650\u6027",level:4},{value:"<strong>\u9002\u7528\u573a\u666f</strong>",id:"\u9002\u7528\u573a\u666f",level:4},{value:"<strong>\u603b\u7ed3</strong>",id:"\u603b\u7ed3",level:3}];function h(e){const n={br:"br",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Server-Sent Events\uff08SEE\uff09\u662f\u4e00\u79cd\u57fa\u4e8eHTTP\u534f\u8bae\u7684\u8f7b\u91cf\u7ea7\u670d\u52a1\u5668\u63a8\u9001\u6280\u672f\uff0c\u5176\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\u53ef\u4ee5\u6982\u62ec\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6838\u5fc3\u8981\u70b9\uff1a"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u57fa\u4e8ehttp\u957f\u8fde\u63a5\u7684\u5355\u5411\u901a\u4fe1",children:(0,t.jsx)(n.strong,{children:"1. \u57fa\u4e8eHTTP\u957f\u8fde\u63a5\u7684\u5355\u5411\u901a\u4fe1"})}),"\n",(0,t.jsxs)(n.p,{children:["SEE\u4f7f\u7528\u6807\u51c6\u7684HTTP\u534f\u8bae\u5b9e\u73b0\u670d\u52a1\u5668\u5230\u5ba2\u6237\u7aef\u7684\u5355\u5411\u6570\u636e\u63a8\u9001\u3002\u4e0e\u4f20\u7edfHTTP\u8bf7\u6c42\u4e0d\u540c\u7684\u662f\uff0cSEE\u901a\u8fc7",(0,t.jsx)(n.strong,{children:"\u4fdd\u6301HTTP\u8fde\u63a5\u6253\u5f00"}),"\uff08\u957f\u8fde\u63a5\uff09\uff0c\u5141\u8bb8\u670d\u52a1\u5668\u5728\u6709\u65b0\u6570\u636e\u65f6\u968f\u65f6\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u3002"]}),"\n",(0,t.jsx)(n.h4,{id:"\u5de5\u4f5c\u6d41\u7a0b",children:(0,t.jsx)(n.strong,{children:"\u5de5\u4f5c\u6d41\u7a0b"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42"}),"\uff1a",(0,t.jsx)(n.br,{}),"\n","\u5ba2\u6237\u7aef\u901a\u8fc7\u521b\u5efa",(0,t.jsx)(n.code,{children:"EventSource"}),"\u5bf9\u8c61\u5411\u670d\u52a1\u5668\u53d1\u9001HTTP\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5934\u4e2d\u5305\u542b\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Accept: text/event-stream\nCache-Control: no-cache\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8868\u660e\u5ba2\u6237\u7aef\u671f\u671b\u63a5\u6536\u4e8b\u4ef6\u6d41\u683c\u5f0f\u7684\u6570\u636e\u3002"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u670d\u52a1\u5668\u54cd\u5e94\u5e76\u4fdd\u6301\u8fde\u63a5"}),"\uff1a",(0,t.jsx)(n.br,{}),"\n","\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801",(0,t.jsx)(n.code,{children:"200 OK"}),"\uff0c\u5e76\u8bbe\u7f6e\u54cd\u5e94\u5934\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Content-Type: text/event-stream\nCache-Control: no-cache\nConnection: keep-alive\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u7136\u540e",(0,t.jsx)(n.strong,{children:"\u4e0d\u5173\u95ed\u8fde\u63a5"}),"\uff0c\u800c\u662f\u6301\u7eed\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6570\u636e\u63a8\u9001"}),"\uff1a",(0,t.jsx)(n.br,{}),"\n","\u670d\u52a1\u5668\u4ee5\u7279\u5b9a\u683c\u5f0f\uff08\u89c1\u4e0b\u6587\uff09\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7\u76d1\u542c\u4e8b\u4ef6\u63a5\u6536\u8fd9\u4e9b\u6570\u636e\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-\u6570\u636e\u683c\u5f0fevent-stream",children:(0,t.jsx)(n.strong,{children:"2. \u6570\u636e\u683c\u5f0f\uff1aEvent Stream"})}),"\n",(0,t.jsxs)(n.p,{children:["\u670d\u52a1\u5668\u53d1\u9001\u7684\u6570\u636e\u5fc5\u987b\u9075\u5faa",(0,t.jsx)(n.code,{children:"text/event-stream"}),"\u683c\u5f0f\uff0c\u6bcf\u884c\u4ee5",(0,t.jsx)(n.code,{children:"field: value"}),"\u5f62\u5f0f\u5b58\u5728\uff0c\u7a7a\u884c\u8868\u793a\u6d88\u606f\u7ed3\u675f\u3002\u5e38\u89c1\u5b57\u6bb5\u5305\u62ec\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"data"}),": \u5b9e\u9645\u6570\u636e\u5185\u5bb9\uff08\u5fc5\u9009\uff09\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"event"}),": \u4e8b\u4ef6\u7c7b\u578b\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\u4e3a",(0,t.jsx)(n.code,{children:"message"}),"\uff09\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"id"}),": \u4e8b\u4ef6ID\uff08\u53ef\u9009\uff0c\u7528\u4e8e\u91cd\u8fde\u65f6\u6062\u590d\u72b6\u6001\uff09\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"retry"}),": \u91cd\u8fde\u8d85\u65f6\u65f6\u95f4\uff08\u6beb\u79d2\uff0c\u53ef\u9009\uff09\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"\u793a\u4f8b",children:(0,t.jsx)(n.strong,{children:"\u793a\u4f8b"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'data: This is a simple message\\n\\n\nevent: notification\\n\ndata: {"title": "New Message", "body": "You have 3 new messages"}\\n\\n\nid: 12345\\n\ndata: Update #12345\\n\\n\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-\u81ea\u52a8\u91cd\u8fde\u673a\u5236",children:(0,t.jsx)(n.strong,{children:"3. \u81ea\u52a8\u91cd\u8fde\u673a\u5236"})}),"\n",(0,t.jsxs)(n.p,{children:["SEE\u7684\u4e00\u5927\u4f18\u52bf\u662f\u6d4f\u89c8\u5668\u4f1a",(0,t.jsx)(n.strong,{children:"\u81ea\u52a8\u5904\u7406\u91cd\u8fde"}),"\uff0c\u5f53\u8fde\u63a5\u610f\u5916\u65ad\u5f00\u65f6\uff08\u5982\u7f51\u7edc\u6ce2\u52a8\uff09\uff0c\u6d4f\u89c8\u5668\u4f1a\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\u81ea\u52a8\u5c1d\u8bd5\u91cd\u65b0\u8fde\u63a5\u670d\u52a1\u5668\u3002\u670d\u52a1\u5668\u53ef\u901a\u8fc7",(0,t.jsx)(n.code,{children:"retry"}),"\u5b57\u6bb5\u6307\u5b9a\u91cd\u8fde\u95f4\u9694\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"retry: 5000\\n\ndata: Server will be back soon\\n\\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-\u5ba2\u6237\u7aef\u5b9e\u73b0javascript",children:(0,t.jsx)(n.strong,{children:"4. \u5ba2\u6237\u7aef\u5b9e\u73b0\uff08JavaScript\uff09"})}),"\n",(0,t.jsxs)(n.p,{children:["\u6d4f\u89c8\u5668\u901a\u8fc7",(0,t.jsx)(n.code,{children:"EventSource"}),"\u63a5\u53e3\u63d0\u4f9bSEE\u652f\u6301\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const eventSource = new EventSource('/api/events');\n\n// \u76d1\u542c\u9ed8\u8ba4\u4e8b\u4ef6\uff08\u672a\u6307\u5b9aevent\u5b57\u6bb5\u65f6\uff09\neventSource.onmessage = (event) => {\n  console.log('Received:', event.data);\n};\n\n// \u76d1\u542c\u81ea\u5b9a\u4e49\u4e8b\u4ef6\neventSource.addEventListener('notification', (event) => {\n  const data = JSON.parse(event.data);\n  console.log('Notification:', data.title);\n});\n\n// \u9519\u8bef\u5904\u7406\neventSource.onerror = (error) => {\n  console.error('EventSource failed:', error);\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-\u670d\u52a1\u5668\u5b9e\u73b0\u793a\u4f8b",children:(0,t.jsx)(n.strong,{children:"5. \u670d\u52a1\u5668\u5b9e\u73b0\u793a\u4f8b"})}),"\n",(0,t.jsx)(n.p,{children:"\u4ee5\u4e0b\u662fNode.js + Express\u5b9e\u73b0SEE\u670d\u52a1\u5668\u7684\u7b80\u5316\u793a\u4f8b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst app = express();\n\napp.get('/api/events', (req, res) => {\n  // \u8bbe\u7f6e\u54cd\u5e94\u5934\n  res.writeHead(200, {\n    'Content-Type': 'text/event-stream',\n    'Cache-Control': 'no-cache',\n    'Connection': 'keep-alive',\n  });\n\n  // \u53d1\u9001\u521d\u59cb\u6570\u636e\n  res.write('data: Connected!\\n\\n');\n\n  // \u5b9a\u65f6\u63a8\u9001\u6570\u636e\uff08\u4f8b\u5982\u6bcf5\u79d2\uff09\n  const intervalId = setInterval(() => {\n    const message = `data: Server time is ${new Date().toISOString()}\\n\\n`;\n    res.write(message);\n  }, 5000);\n\n  // \u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u65f6\u6e05\u7406\u8d44\u6e90\n  req.on('close', () => {\n    clearInterval(intervalId);\n    res.end();\n  });\n});\n\napp.listen(3000, () => console.log('Server running on port 3000'));\n"})}),"\n",(0,t.jsx)(n.h3,{id:"6-\u4e0ewebsocket\u7684\u6838\u5fc3\u5dee\u5f02",children:(0,t.jsx)(n.strong,{children:"6. \u4e0eWebSocket\u7684\u6838\u5fc3\u5dee\u5f02"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7279\u6027"}),(0,t.jsx)(n.th,{children:"Server-Sent Events"}),(0,t.jsx)(n.th,{children:"WebSocket"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u534f\u8bae"})}),(0,t.jsx)(n.td,{children:"HTTP"}),(0,t.jsx)(n.td,{children:"\u72ec\u7acb\u7684WebSocket\u534f\u8bae"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u8fde\u63a5\u7ba1\u7406"})}),(0,t.jsx)(n.td,{children:"\u7531\u6d4f\u89c8\u5668\u81ea\u52a8\u91cd\u8fde"}),(0,t.jsx)(n.td,{children:"\u9700\u8981\u624b\u52a8\u5b9e\u73b0\u91cd\u8fde\u903b\u8f91"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u6570\u636e\u65b9\u5411"})}),(0,t.jsx)(n.td,{children:"\u5355\u5411\uff08\u670d\u52a1\u5668\u2192\u5ba2\u6237\u7aef\uff09"}),(0,t.jsx)(n.td,{children:"\u53cc\u5411"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u4e8c\u8fdb\u5236\u652f\u6301"})}),(0,t.jsx)(n.td,{children:"\u4ec5\u6587\u672c"}),(0,t.jsx)(n.td,{children:"\u652f\u6301\u6587\u672c\u548c\u4e8c\u8fdb\u5236"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"\u590d\u6742\u5ea6"})}),(0,t.jsx)(n.td,{children:"\u7b80\u5355\uff08\u57fa\u4e8eHTTP\uff09"}),(0,t.jsx)(n.td,{children:"\u8f83\u9ad8\uff08\u9700\u8981\u5904\u7406\u63e1\u624b\u3001\u5e27\u7b49\uff09"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"7-\u5c40\u9650\u6027\u4e0e\u9002\u7528\u573a\u666f",children:(0,t.jsx)(n.strong,{children:"7. \u5c40\u9650\u6027\u4e0e\u9002\u7528\u573a\u666f"})}),"\n",(0,t.jsx)(n.h4,{id:"\u5c40\u9650\u6027",children:(0,t.jsx)(n.strong,{children:"\u5c40\u9650\u6027"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u5355\u5411\u901a\u4fe1"}),"\uff1a\u65e0\u6cd5\u5b9e\u73b0\u5ba2\u6237\u7aef\u4e3b\u52a8\u5411\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u6d4f\u89c8\u5668\u517c\u5bb9\u6027"}),"\uff1aIE\u4e0d\u652f\u6301\uff0c\u9700\u4f7f\u7528Polyfill\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u6027\u80fd"}),"\uff1a\u957f\u8fde\u63a5\u4f1a\u5360\u7528\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u9ad8\u5e76\u53d1\u573a\u666f\u9700\u4f18\u5316\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"\u9002\u7528\u573a\u666f",children:(0,t.jsx)(n.strong,{children:"\u9002\u7528\u573a\u666f"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5b9e\u65f6\u901a\u77e5\uff08\u5982\u90ae\u4ef6\u63d0\u9192\u3001\u793e\u4ea4\u5a92\u4f53\u66f4\u65b0\uff09\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u80a1\u7968\u884c\u60c5\u3001\u4f53\u80b2\u8d5b\u4e8b\u6bd4\u5206\u7b49\u5b9e\u65f6\u6570\u636e\u63a8\u9001\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u65b0\u95fb\u66f4\u65b0\u3001\u535a\u5ba2\u8ba2\u9605\u7b49\u5185\u5bb9\u63a8\u9001\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u603b\u7ed3",children:(0,t.jsx)(n.strong,{children:"\u603b\u7ed3"})}),"\n",(0,t.jsx)(n.p,{children:"SEE\u901a\u8fc7\u4fdd\u6301HTTP\u957f\u8fde\u63a5\u548c\u7279\u5b9a\u7684\u6570\u636e\u683c\u5f0f\uff0c\u5b9e\u73b0\u4e86\u670d\u52a1\u5668\u5230\u5ba2\u6237\u7aef\u7684\u8f7b\u91cf\u7ea7\u5355\u5411\u901a\u4fe1\uff0c\u5176\u6838\u5fc3\u4f18\u52bf\u5728\u4e8e\u7b80\u5355\u6613\u7528\u3001\u81ea\u52a8\u91cd\u8fde\uff0c\u9002\u5408\u4e0d\u9700\u8981\u53cc\u5411\u901a\u4fe1\u7684\u5b9e\u65f6\u63a8\u9001\u573a\u666f\u3002"})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>i});var s=r(6540);const t={},l=s.createContext(t);function d(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);