"use strict";(self.webpackChunkys_blog=self.webpackChunkys_blog||[]).push([[6e3],{7497:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>u,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>i});const r=JSON.parse('{"id":"\u6e90\u7801\u5206\u6790/React/context\u5b9e\u73b0\u539f\u7406","title":"React Context","description":"\u4f5c\u7528","source":"@site/frontend/\u6e90\u7801\u5206\u6790/React/context\u5b9e\u73b0\u539f\u7406.md","sourceDirName":"\u6e90\u7801\u5206\u6790/React","slug":"/\u6e90\u7801\u5206\u6790/React/context\u5b9e\u73b0\u539f\u7406","permalink":"/frontend/\u6e90\u7801\u5206\u6790/React/context\u5b9e\u73b0\u539f\u7406","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/frontend/\u6e90\u7801\u5206\u6790/React/context\u5b9e\u73b0\u539f\u7406.md","tags":[],"version":"current","frontMatter":{},"sidebar":"frontend","previous":{"title":"Scheduler\u8c03\u5ea6\u7b97\u6cd5","permalink":"/frontend/\u6e90\u7801\u5206\u6790/React/Scheduler\u8c03\u5ea6\u7b97\u6cd5"},"next":{"title":"\u4efb\u52a1\u5207\u7247","permalink":"/frontend/\u6e90\u7801\u5206\u6790/React/\u4efb\u52a1\u5207\u7247"}}');var o=t(4848),c=t(8453);const s={},u="React Context",l={},i=[{value:"\u4f5c\u7528",id:"\u4f5c\u7528",level:2},{value:"\u7528\u6cd5",id:"\u7528\u6cd5",level:2},{value:"\u8bbe\u8ba1\u6a21\u5f0f",id:"\u8bbe\u8ba1\u6a21\u5f0f",level:2},{value:"\u5b9e\u73b0\u7b80\u6613Context \u6a21\u578b",id:"\u5b9e\u73b0\u7b80\u6613context-\u6a21\u578b",level:2},{value:"context\u5d4c\u5957",id:"context\u5d4c\u5957",level:2},{value:"\u5d4c\u5957 Provider \u7684\u5de5\u4f5c\u539f\u7406",id:"\u5d4c\u5957-provider-\u7684\u5de5\u4f5c\u539f\u7406",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"react-context",children:"React Context"})}),"\n",(0,o.jsx)(n.h2,{id:"\u4f5c\u7528",children:"\u4f5c\u7528"}),"\n",(0,o.jsx)(n.p,{children:"\u6570\u636e\u5171\u4eab\u3001\u6df1\u5c42\u4f20\u9012\u53c2\u6570"}),"\n",(0,o.jsx)(n.h2,{id:"\u7528\u6cd5",children:"\u7528\u6cd5"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"import { createContext } from 'react';\n\n// 1 createContext\nconst ThemeContext = createContext('light');\n\n// 2 ThemeContext \u6ce8\uff1a19\u7248\u672c\u4ee5\u524d\u9700\u8981\u4f7f\u7528Provider <ThemeContext.Provider>\nfunction App() {\n  const [theme, setTheme] = useState('light');\n  // \u2026\u2026\n  return (\n    <ThemeContext value={theme}>\n      <Page />\n    </ThemeContext>\n  );\n}\n\n// 3 useContext\nfunction Button() {\n  // \u2705 \u63a8\u8350\u65b9\u5f0f\n  const theme = useContext(ThemeContext);\n  return <button className={theme} />;\n}\n// \u4e5f\u53ef\u901a\u8fc7\u56de\u8c03\u83b7\u53d6\nfunction Button() {\n  // \ud83d\udfe1 \u9057\u7559\u65b9\u5f0f (\u4e0d\u63a8\u8350)\n  return (\n    <ThemeContext.Consumer>\n      {theme => (\n        <button className={theme} />\n      )}\n    </ThemeContext.Consumer>\n  );\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u8bbe\u8ba1\u6a21\u5f0f",children:"\u8bbe\u8ba1\u6a21\u5f0f"}),"\n",(0,o.jsx)(n.p,{children:"\u53d1\u5e03\u8ba2\u9605Provider-Consumer \u6a21\u5f0f\uff1aContext \u63d0\u4f9b\u4e00\u4e2a Provider \u7ec4\u4ef6\u548c\u4e00\u4e2a Consumer \u7ec4\u4ef6\u3002Provider \u7528\u4e8e\u63d0\u4f9b\u6570\u636e\uff0cConsumer \u7528\u4e8e\u6d88\u8d39\u6570\u636e\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"\u5b9e\u73b0\u7b80\u6613context-\u6a21\u578b",children:"\u5b9e\u73b0\u7b80\u6613Context \u6a21\u578b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"import React, { createContext, useContext, useState, useEffect } from 'react';\n\n// 1. \u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684 Context \u6a21\u578b\nclass SimpleContext {\n  constructor(defaultValue) {\n    this.defaultValue = defaultValue;\n    this.consumers = new Set();\n    this.value = defaultValue;\n  }\n\n  // \u8bbe\u7f6e\u65b0\u503c\u5e76\u901a\u77e5\u6240\u6709\u6d88\u8d39\u8005\n  setValue(newValue) {\n    this.value = newValue;\n    this.consumers.forEach(consumer => consumer(this.value));\n  }\n\n  // \u6dfb\u52a0\u6d88\u8d39\u8005\n  subscribe(consumer) {\n    this.consumers.add(consumer);\n    return () => this.consumers.delete(consumer);\n  }\n}\n\n// 2. \u521b\u5efa Provider \u7ec4\u4ef6\nfunction SimpleProvider({ context, value, children }) {\n  const [currentValue, setCurrentValue] = useState(value);\n  \n  useEffect(() => {\n    // \u66f4\u65b0 context \u7684\u503c\n    context.setValue(currentValue);\n    \n    // \u76d1\u542c\u5916\u90e8\u4f20\u5165\u7684 value \u53d8\u5316\n    const unsubscribe = context.subscribe(newValue => {\n      setCurrentValue(newValue);\n    });\n    \n    return unsubscribe;\n  }, [context, value]);\n\n  return <>{children}</>;\n}\n\n// 3. \u521b\u5efa Consumer \u7ec4\u4ef6\nfunction SimpleConsumer({ context, children }) {\n  const [value, setValue] = useState(context.value);\n  \n  useEffect(() => {\n    // \u8ba2\u9605 context \u7684\u53d8\u5316\n    const unsubscribe = context.subscribe(newValue => {\n      setValue(newValue);\n    });\n    \n    return unsubscribe;\n  }, [context]);\n\n  // children \u5e94\u8be5\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u63a5\u6536 context \u503c\u5e76\u8fd4\u56de JSX\n  return typeof children === 'function' \n    ? children(value) \n    : null;\n}\n\n// 4. \u521b\u5efa\u4e00\u4e2a\u94a9\u5b50\u51fd\u6570\u6765\u7b80\u5316\u4f7f\u7528\nfunction useSimpleContext(context) {\n  const [value, setValue] = useState(context.value);\n  \n  useEffect(() => {\n    const unsubscribe = context.subscribe(newValue => {\n      setValue(newValue);\n    });\n    \n    return unsubscribe;\n  }, [context]);\n\n  return value;\n}\n\n// 5. \u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u51fd\u6570\u6765\u751f\u6210 context \u5bf9\u8c61\nfunction createSimpleContext(defaultValue) {\n  const context = new SimpleContext(defaultValue);\n  \n  return {\n    Provider: ({ value, children }) => (\n      <SimpleProvider context={context} value={value}>\n        {children}\n      </SimpleProvider>\n    ),\n    Consumer: ({ children }) => (\n      <SimpleConsumer context={context}>\n        {children}\n      </SimpleConsumer>\n    ),\n    useContext: () => useSimpleContext(context),\n    defaultValue\n  };\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nfunction Example() {\n  // \u521b\u5efa\u4e00\u4e2a\u4e3b\u9898 context\n  const ThemeContext = createSimpleContext('light');\n  \n  return (\n    <ThemeContext.Provider value=\"dark\">\n      <div>\n        <h2>\u4f7f\u7528 Consumer \u7ec4\u4ef6</h2>\n        <ThemeContext.Consumer>\n          {theme => <p>\u5f53\u524d\u4e3b\u9898: {theme}</p>}\n        </ThemeContext.Consumer>\n        \n        <h2>\u4f7f\u7528 useContext \u94a9\u5b50</h2>\n        <ThemeDisplay />\n      </div>\n    </ThemeContext.Provider>\n  );\n}\n\nfunction ThemeDisplay() {\n  const theme = useSimpleContext(Example.ThemeContext);\n  return <p>\u94a9\u5b50\u83b7\u53d6\u7684\u4e3b\u9898: {theme}</p>;\n}\n\nexport { createSimpleContext };\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"context\u5d4c\u5957",children:"context\u5d4c\u5957"}),"\n",(0,o.jsx)(n.p,{children:"\u8986\u76d6\u6765\u81ea\u4e0a\u5c42\u7684\u67d0\u4e9b context \u7684\u552f\u4e00\u65b9\u6cd5\u662f\u5c06\u5b50\u7ec4\u4ef6\u5305\u88f9\u5230\u4e00\u4e2a\u63d0\u4f9b\u4e0d\u540c\u503c\u7684 context provider \u4e2d"}),"\n",(0,o.jsx)(n.h3,{id:"\u5d4c\u5957-provider-\u7684\u5de5\u4f5c\u539f\u7406",children:"\u5d4c\u5957 Provider \u7684\u5de5\u4f5c\u539f\u7406"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5f53\u4e00\u4e2a\u7ec4\u4ef6\u6811\u4e2d\u6709\u591a\u4e2a\u5d4c\u5957\u7684 Provider \u65f6\uff0c\u6bcf\u4e2a Provider \u90fd\u4f1a\u5c06\u81ea\u5df1\u7684\u503c\u63a8\u5165\u6808\u4e2d"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u6d88\u8d39\u8005\u7ec4\u4ef6\u603b\u662f\u83b7\u53d6\u6808\u9876\u7684\u503c\uff0c\u8fd9\u4ee3\u8868\u6700\u8fd1\u7684 Provider"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5f53\u4e00\u4e2a Provider \u5378\u8f7d\u65f6\uff0c\u5b83\u7684\u503c\u4f1a\u4ece\u6808\u4e2d\u5f39\u51fa\uff0c\u6d88\u8d39\u8005\u4f1a\u81ea\u52a8\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6700\u8fd1\u7684 Provider \u503c"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5982\u679c\u6ca1\u6709\u627e\u5230\u4efb\u4f55 Provider\uff0c\u6d88\u8d39\u8005\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u503c"}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>u});var r=t(6540);const o={},c=r.createContext(o);function s(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function u(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);