"use strict";(self.webpackChunkys_blog=self.webpackChunkys_blog||[]).push([[9410],{7567:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"\u524d\u7aef\u6846\u67b6/React/\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0setState\u6570\u636e\u66f4\u65b0\u56de\u8c03","title":"\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0setState\u6570\u636e\u66f4\u65b0\u56de\u8c03","description":"\u5728 React \u51fd\u6570\u7ec4\u4ef6\u4e2d\uff0cuseState \u672c\u8eab\u6ca1\u6709\u50cf\u7c7b\u7ec4\u4ef6 setState \u90a3\u6837\u7684\u76f4\u63a5\u56de\u8c03\u53c2\u6570\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u65b9\u5f0f\u5b9e\u73b0\u7c7b\u4f3c\u7684\u56de\u8c03\u6548\u679c\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\uff1a","source":"@site/frontend/\u524d\u7aef\u6846\u67b6/React/\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0setState\u6570\u636e\u66f4\u65b0\u56de\u8c03.md","sourceDirName":"\u524d\u7aef\u6846\u67b6/React","slug":"/\u524d\u7aef\u6846\u67b6/React/\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0setState\u6570\u636e\u66f4\u65b0\u56de\u8c03","permalink":"/frontend/\u524d\u7aef\u6846\u67b6/React/\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0setState\u6570\u636e\u66f4\u65b0\u56de\u8c03","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/frontend/\u524d\u7aef\u6846\u67b6/React/\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0setState\u6570\u636e\u66f4\u65b0\u56de\u8c03.md","tags":[],"version":"current","frontMatter":{},"sidebar":"frontend","previous":{"title":"\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0ref","permalink":"/frontend/\u524d\u7aef\u6846\u67b6/React/\u51fd\u6570\u7ec4\u4ef6\u5b9e\u73b0ref"},"next":{"title":"\u5b9e\u73b0\u52a8\u6001\u751f\u6210redux\u5207\u7247","permalink":"/frontend/\u524d\u7aef\u6846\u67b6/React/\u5b9e\u73b0\u52a8\u6001\u751f\u6210redux\u5207\u7247"}}');var c=n(4848),r=n(8453);const o={},a=void 0,l={},i=[{value:"<strong>1. \u4f7f\u7528 <code>useEffect</code> \u76d1\u542c\u72b6\u6001\u53d8\u5316</strong>",id:"1-\u4f7f\u7528-useeffect-\u76d1\u542c\u72b6\u6001\u53d8\u5316",level:3},{value:"<strong>2. \u81ea\u5b9a\u4e49 Hook \u5c01\u88c5\u56de\u8c03\u903b\u8f91</strong>",id:"2-\u81ea\u5b9a\u4e49-hook-\u5c01\u88c5\u56de\u8c03\u903b\u8f91",level:3},{value:"<strong>3. \u4f7f\u7528 Promise \u548c async/await\uff08\u9ad8\u7ea7\u65b9\u6848\uff09</strong>",id:"3-\u4f7f\u7528-promise-\u548c-asyncawait\u9ad8\u7ea7\u65b9\u6848",level:3},{value:"<strong>4. \u5728 <code>useEffect</code> \u4e2d\u5904\u7406\u526f\u4f5c\u7528</strong>",id:"4-\u5728-useeffect-\u4e2d\u5904\u7406\u526f\u4f5c\u7528",level:3},{value:"<strong>\u6ce8\u610f\u4e8b\u9879</strong>",id:"\u6ce8\u610f\u4e8b\u9879",level:3},{value:"<strong>\u603b\u7ed3</strong>",id:"\u603b\u7ed3",level:3}];function d(e){const t={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(t.p,{children:["\u5728 React \u51fd\u6570\u7ec4\u4ef6\u4e2d\uff0c",(0,c.jsx)(t.code,{children:"useState"})," \u672c\u8eab\u6ca1\u6709\u50cf\u7c7b\u7ec4\u4ef6 ",(0,c.jsx)(t.code,{children:"setState"})," \u90a3\u6837\u7684\u76f4\u63a5\u56de\u8c03\u53c2\u6570\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u65b9\u5f0f\u5b9e\u73b0\u7c7b\u4f3c\u7684\u56de\u8c03\u6548\u679c\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\uff1a"]}),"\n",(0,c.jsx)(t.h3,{id:"1-\u4f7f\u7528-useeffect-\u76d1\u542c\u72b6\u6001\u53d8\u5316",children:(0,c.jsxs)(t.strong,{children:["1. \u4f7f\u7528 ",(0,c.jsx)(t.code,{children:"useEffect"})," \u76d1\u542c\u72b6\u6001\u53d8\u5316"]})}),"\n",(0,c.jsxs)(t.p,{children:["\u6700\u5e38\u7528\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 ",(0,c.jsx)(t.code,{children:"useEffect"})," \u76d1\u542c\u72b6\u6001\u53d8\u5316\uff0c\u5728\u4f9d\u8d56\u9879\u6570\u7ec4\u4e2d\u5305\u542b\u76ee\u6807\u72b6\u6001\uff1a"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-jsx",children:"import { useState, useEffect } from 'react';\n\nfunction Example() {\n  const [count, setCount] = useState(0);\n\n  // \u7c7b\u4f3c componentDidUpdate\n  useEffect(() => {\n    // \u72b6\u6001\u66f4\u65b0\u540e\u6267\u884c\u7684\u56de\u8c03\u903b\u8f91\n    console.log('Count updated:', count);\n  }, [count]); // \u4ec5\u5728 count \u53d8\u5316\u65f6\u6267\u884c\n\n  const increment = () => {\n    setCount(prev => prev + 1);\n    // \u8fd9\u91cc\u65e0\u6cd5\u7acb\u5373\u83b7\u53d6\u66f4\u65b0\u540e\u7684 count \u503c\n  };\n\n  return <button onClick={increment}>Count: {count}</button>;\n}\n"})}),"\n",(0,c.jsx)(t.h3,{id:"2-\u81ea\u5b9a\u4e49-hook-\u5c01\u88c5\u56de\u8c03\u903b\u8f91",children:(0,c.jsx)(t.strong,{children:"2. \u81ea\u5b9a\u4e49 Hook \u5c01\u88c5\u56de\u8c03\u903b\u8f91"})}),"\n",(0,c.jsxs)(t.p,{children:["\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49 Hook \u6765\u6a21\u62df\u5e26\u56de\u8c03\u7684 ",(0,c.jsx)(t.code,{children:"setState"}),"\uff1a"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-jsx",children:"import { useState, useEffect, useRef } from 'react';\n\nfunction useCallbackState(initialState) {\n  const [state, setState] = useState(initialState);\n  const callbackRef = useRef(null);\n\n  const setStateWithCallback = (newState, callback) => {\n    callbackRef.current = callback; // \u4fdd\u5b58\u56de\u8c03\u51fd\u6570\n    setState(newState);\n  };\n\n  useEffect(() => {\n    if (callbackRef.current) {\n      callbackRef.current(state); // \u72b6\u6001\u66f4\u65b0\u540e\u6267\u884c\u56de\u8c03\n      callbackRef.current = null; // \u91cd\u7f6e\u56de\u8c03\n    }\n  }, [state]);\n\n  return [state, setStateWithCallback];\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nfunction Example() {\n  const [count, setCount] = useCallbackState(0);\n\n  const increment = () => {\n    setCount(prev => prev + 1, (newCount) => {\n      console.log('Callback after update:', newCount);\n    });\n  };\n\n  return <button onClick={increment}>Count: {count}</button>;\n}\n"})}),"\n",(0,c.jsx)(t.h3,{id:"3-\u4f7f\u7528-promise-\u548c-asyncawait\u9ad8\u7ea7\u65b9\u6848",children:(0,c.jsx)(t.strong,{children:"3. \u4f7f\u7528 Promise \u548c async/await\uff08\u9ad8\u7ea7\u65b9\u6848\uff09"})}),"\n",(0,c.jsx)(t.p,{children:"\u5c06\u56de\u8c03\u5c01\u88c5\u4e3a Promise\uff0c\u4f7f\u72b6\u6001\u66f4\u65b0\u53ef\u4ee5\u7b49\u5f85\uff1a"}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-jsx",children:"import { useState, useRef } from 'react';\n\nfunction usePromiseState(initialState) {\n  const [state, setState] = useState(initialState);\n  const resolvers = useRef([]);\n\n  const setStateAsync = (newState) => {\n    return new Promise((resolve) => {\n      resolvers.current.push(resolve);\n      setState((prev) =>\n        typeof newState === 'function' ? newState(prev) : newState\n      );\n    });\n  };\n\n  // \u72b6\u6001\u66f4\u65b0\u540e\u6267\u884c\u6240\u6709\u7b49\u5f85\u7684 resolve\n  useState(() => {\n    resolvers.current.forEach((resolve) => resolve(state));\n    resolvers.current = [];\n  }, [state]);\n\n  return [state, setStateAsync];\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nasync function handleClick() {\n  await setCount(prev => prev + 1);\n  // \u6b64\u65f6 count \u5df2\u66f4\u65b0\n  console.log('Count is now:', count);\n}\n"})}),"\n",(0,c.jsx)(t.h3,{id:"4-\u5728-useeffect-\u4e2d\u5904\u7406\u526f\u4f5c\u7528",children:(0,c.jsxs)(t.strong,{children:["4. \u5728 ",(0,c.jsx)(t.code,{children:"useEffect"})," \u4e2d\u5904\u7406\u526f\u4f5c\u7528"]})}),"\n",(0,c.jsxs)(t.p,{children:["\u5982\u679c\u56de\u8c03\u662f\u4e3a\u4e86\u6267\u884c\u526f\u4f5c\u7528\uff08\u5982 API \u8bf7\u6c42\uff09\uff0c\u76f4\u63a5\u5728 ",(0,c.jsx)(t.code,{children:"useEffect"})," \u4e2d\u5904\u7406\uff1a"]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-jsx",children:"function Example() {\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  // \u72b6\u6001\u53d8\u5316\u65f6\u89e6\u53d1\u526f\u4f5c\u7528\n  useEffect(() => {\n    if (data) {\n      // \u5904\u7406\u6570\u636e\u66f4\u65b0\u540e\u7684\u903b\u8f91\n      console.log('Data loaded:', data);\n      setLoading(false);\n    }\n  }, [data]);\n\n  const fetchData = async () => {\n    setLoading(true);\n    const result = await fetchDataFromAPI();\n    setData(result); // \u6570\u636e\u66f4\u65b0\u540e\uff0c\u4e0a\u9762\u7684 useEffect \u4f1a\u89e6\u53d1\n  };\n\n  return <button onClick={fetchData}>{loading ? 'Loading...' : 'Fetch'}</button>;\n}\n"})}),"\n",(0,c.jsx)(t.h3,{id:"\u6ce8\u610f\u4e8b\u9879",children:(0,c.jsx)(t.strong,{children:"\u6ce8\u610f\u4e8b\u9879"})}),"\n",(0,c.jsxs)(t.ol,{children:["\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"\u5f02\u6b65\u7279\u6027"}),"\uff1aReact \u7684\u72b6\u6001\u66f4\u65b0\u662f\u5f02\u6b65\u7684\uff0c\u65e0\u8bba\u4f7f\u7528\u54ea\u79cd\u65b9\u5f0f\uff0c\u90fd\u65e0\u6cd5\u5728 ",(0,c.jsx)(t.code,{children:"setState"})," \u540e\u7acb\u5373\u83b7\u53d6\u66f4\u65b0\u540e\u7684\u503c\u3002"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"\u4f9d\u8d56\u9879\u6570\u7ec4"}),"\uff1a",(0,c.jsx)(t.code,{children:"useEffect"})," \u7684\u4f9d\u8d56\u9879\u6570\u7ec4\u5fc5\u987b\u6b63\u786e\u8bbe\u7f6e\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u65e0\u9650\u5faa\u73af\u6216\u56de\u8c03\u4e0d\u6267\u884c\u3002"]}),"\n",(0,c.jsxs)(t.li,{children:[(0,c.jsx)(t.strong,{children:"\u6027\u80fd\u8003\u8651"}),"\uff1a\u81ea\u5b9a\u4e49 Hook \u6216 Promise \u65b9\u6848\u4f1a\u589e\u52a0\u989d\u5916\u7684\u5f00\u9500\uff0c\u4ec5\u5728\u5fc5\u8981\u65f6\u4f7f\u7528\u3002"]}),"\n"]}),"\n",(0,c.jsx)(t.h3,{id:"\u603b\u7ed3",children:(0,c.jsx)(t.strong,{children:"\u603b\u7ed3"})}),"\n",(0,c.jsxs)(t.table,{children:[(0,c.jsx)(t.thead,{children:(0,c.jsxs)(t.tr,{children:[(0,c.jsx)(t.th,{children:(0,c.jsx)(t.strong,{children:"\u65b9\u6cd5"})}),(0,c.jsx)(t.th,{children:(0,c.jsx)(t.strong,{children:"\u9002\u7528\u573a\u666f"})}),(0,c.jsx)(t.th,{children:(0,c.jsx)(t.strong,{children:"\u793a\u4f8b\u4ee3\u7801"})})]})}),(0,c.jsxs)(t.tbody,{children:[(0,c.jsxs)(t.tr,{children:[(0,c.jsx)(t.td,{children:(0,c.jsx)(t.strong,{children:"useEffect"})}),(0,c.jsx)(t.td,{children:"\u7b80\u5355\u76d1\u542c\u72b6\u6001\u53d8\u5316"}),(0,c.jsx)(t.td,{children:(0,c.jsx)(t.code,{children:"useEffect(() => { /* \u56de\u8c03\u903b\u8f91 */ }, [state])"})})]}),(0,c.jsxs)(t.tr,{children:[(0,c.jsx)(t.td,{children:(0,c.jsx)(t.strong,{children:"\u81ea\u5b9a\u4e49 Hook"})}),(0,c.jsx)(t.td,{children:"\u9700\u8981\u7c7b\u4f3c\u7c7b\u7ec4\u4ef6\u7684\u56de\u8c03\u8bed\u6cd5"}),(0,c.jsx)(t.td,{children:(0,c.jsx)(t.code,{children:"setState(newValue, callback)"})})]}),(0,c.jsxs)(t.tr,{children:[(0,c.jsx)(t.td,{children:(0,c.jsx)(t.strong,{children:"Promise/async"})}),(0,c.jsx)(t.td,{children:"\u9700\u8981\u94fe\u5f0f\u8c03\u7528\u6216\u5f02\u6b65\u64cd\u4f5c"}),(0,c.jsx)(t.td,{children:(0,c.jsx)(t.code,{children:"await setStateAsync(newValue)"})})]}),(0,c.jsxs)(t.tr,{children:[(0,c.jsx)(t.td,{children:(0,c.jsx)(t.strong,{children:"\u76f4\u63a5\u5728 useEffect \u4e2d\u5904\u7406"})}),(0,c.jsx)(t.td,{children:"\u72b6\u6001\u53d8\u5316\u540e\u6267\u884c\u526f\u4f5c\u7528\uff08\u5982 API \u8bf7\u6c42\uff09"}),(0,c.jsx)(t.td,{children:(0,c.jsx)(t.code,{children:"useEffect(() => { /* \u526f\u4f5c\u7528\u903b\u8f91 */ }, [state])"})})]})]})]}),"\n",(0,c.jsxs)(t.p,{children:["\u9009\u62e9\u54ea\u79cd\u65b9\u5f0f\u53d6\u51b3\u4e8e\u5177\u4f53\u573a\u666f\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c",(0,c.jsx)(t.code,{children:"useEffect"})," \u5df2\u7ecf\u8db3\u591f\u5904\u7406\u72b6\u6001\u66f4\u65b0\u540e\u7684\u903b\u8f91\u3002"]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,c.jsx)(t,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(6540);const c={},r=s.createContext(c);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);