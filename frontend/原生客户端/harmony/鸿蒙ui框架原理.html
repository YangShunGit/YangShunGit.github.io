<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-原生客户端/harmony/鸿蒙ui框架原理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">鸿蒙ui框架原理 | 个人知识库</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://YangShunGit.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://YangShunGit.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://YangShunGit.github.io/frontend/原生客户端/harmony/鸿蒙ui框架原理"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="鸿蒙ui框架原理 | 个人知识库"><meta data-rh="true" name="description" content="鸿蒙UI框架（主要指方舟开发框架ArkUI）是鸿蒙生态应用开发的核心UI体系，支持声明式开发范式，其底层实现围绕高效渲染、跨设备适配、状态驱动UI更新三大核心目标设计，融合了编译时优化、增量渲染、硬件加速等技术。以下从核心架构、关键机制、实现细节三个层面解析其底层原理："><meta data-rh="true" property="og:description" content="鸿蒙UI框架（主要指方舟开发框架ArkUI）是鸿蒙生态应用开发的核心UI体系，支持声明式开发范式，其底层实现围绕高效渲染、跨设备适配、状态驱动UI更新三大核心目标设计，融合了编译时优化、增量渲染、硬件加速等技术。以下从核心架构、关键机制、实现细节三个层面解析其底层原理："><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://YangShunGit.github.io/frontend/原生客户端/harmony/鸿蒙ui框架原理"><link data-rh="true" rel="alternate" href="https://YangShunGit.github.io/frontend/原生客户端/harmony/鸿蒙ui框架原理" hreflang="en"><link data-rh="true" rel="alternate" href="https://YangShunGit.github.io/frontend/原生客户端/harmony/鸿蒙ui框架原理" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"鸿蒙ui框架原理","item":"https://YangShunGit.github.io/frontend/原生客户端/harmony/鸿蒙ui框架原理"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="个人知识库 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="个人知识库 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.a03a9115.css">
<script src="/assets/js/runtime~main.180f9b92.js" defer="defer"></script>
<script src="/assets/js/main.aa0e800e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="个人智库" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="个人智库" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">智库</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/frontend/intro">前端</a><a class="navbar__item navbar__link" href="/backend/intro">后端</a><a class="navbar__item navbar__link" href="/blog">博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/YangShunGit/YangShunGit.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/frontend/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/frontend/category/安全防护">安全防护</a><button aria-label="Expand sidebar category &#x27;安全防护&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/frontend/category/版本管理">版本管理</a><button aria-label="Expand sidebar category &#x27;版本管理&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/frontend/category/浏览器">浏览器</a><button aria-label="Expand sidebar category &#x27;浏览器&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/前端框架/React/class组件新增的两个生命周期">前端框架</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/frontend/原生客户端/android/Activity">原生客户端</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/frontend/原生客户端/android/Activity">android</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/frontend/原生客户端/harmony/HAP、HAR、HSP对比">harmony</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/HAP、HAR、HSP对比">HAP、HAR、HSP对比</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/HarmonyOS 中的分布式技术">HarmonyOS 中的分布式技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/hdc">hdc</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/响应式原理">响应式原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/多module机制">多module机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/数据存储">数据存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/状态管理">状态管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/生命周期">生命周期</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/知识点">知识点</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/自动发现授权逻辑">自动发现授权逻辑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/frontend/原生客户端/harmony/鸿蒙ui框架原理">鸿蒙ui框架原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/frontend/原生客户端/harmony/鸿蒙的响应式机制">鸿蒙的响应式机制</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/frontend/原生客户端/vscode/monaco">vscode</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/基础核心/ES6/EventLoop">基础核心</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/性能优化/从浏览器输入开始优化">性能优化</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/构建工具/npm/npm link和软硬链接区别">构建工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/源码分析/React/Diff算法">源码分析</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/frontend/算法题/leetcode/两数之和">算法题</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">原生客户端</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">harmony</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">鸿蒙ui框架原理</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>鸿蒙ui框架原理</h1></header><p>鸿蒙UI框架（主要指方舟开发框架ArkUI）是鸿蒙生态应用开发的核心UI体系，支持声明式开发范式，其底层实现围绕<strong>高效渲染、跨设备适配、状态驱动UI更新</strong>三大核心目标设计，融合了编译时优化、增量渲染、硬件加速等技术。以下从核心架构、关键机制、实现细节三个层面解析其底层原理：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="一核心架构分层设计与跨语言协作">一、核心架构：分层设计与跨语言协作<a href="#一核心架构分层设计与跨语言协作" class="hash-link" aria-label="Direct link to 一、核心架构：分层设计与跨语言协作" title="Direct link to 一、核心架构：分层设计与跨语言协作">​</a></h3>
<p>鸿蒙UI框架采用<strong>分层架构</strong>，从上层开发者接口到底层渲染引擎，各层职责明确且通过标准化接口协作，核心分为三层：</p>
<table><thead><tr><th>层级</th><th>作用</th><th>技术栈/实现</th></tr></thead><tbody><tr><td>应用层</td><td>开发者编写的声明式UI代码（ArkTS/TS），如<code>Column()</code>、<code>Text()</code>等组件调用</td><td>基于ArkTS的声明式语法，通过装饰器（如<code>@Component</code>、<code>@State</code>）描述UI结构与状态</td></tr><tr><td>框架层</td><td>解析UI描述、处理状态管理、生成布局指令</td><td>包含<strong>UI解析引擎</strong>（转换声明式代码为抽象节点）、<strong>状态管理引擎</strong>（依赖收集与更新触发）、<strong>布局引擎</strong>（计算组件位置与大小）</td></tr><tr><td>引擎层</td><td>执行渲染、处理硬件交互、跨设备适配</td><td>包含<strong>渲染引擎</strong>（基于OpenGL/Vulkan的硬件加速渲染）、<strong>合成器</strong>（图层合并）、<strong>设备抽象层</strong>（统一多设备接口）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="二关键机制从代码到界面的完整流程">二、关键机制：从代码到界面的完整流程<a href="#二关键机制从代码到界面的完整流程" class="hash-link" aria-label="Direct link to 二、关键机制：从代码到界面的完整流程" title="Direct link to 二、关键机制：从代码到界面的完整流程">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-声明式ui的解析与转换">1. 声明式UI的解析与转换<a href="#1-声明式ui的解析与转换" class="hash-link" aria-label="Direct link to 1. 声明式UI的解析与转换" title="Direct link to 1. 声明式UI的解析与转换">​</a></h4>
<p>开发者编写的声明式UI代码（如<code>Column() { Text(&#x27;Hello&#x27;) }</code>）并非直接执行渲染，而是先经过框架层的<strong>UI解析引擎</strong>处理：</p>
<ul>
<li><strong>抽象语法树（AST）生成</strong>：ArkTS编译器将UI代码转换为AST，提取组件结构（如<code>Column</code>是容器组件，<code>Text</code>是叶子组件）、属性（如<code>fontSize</code>）、事件（如<code>onClick</code>）。</li>
<li><strong>UI节点树构建</strong>：AST被转换为<strong>UI节点树</strong>（包含组件类型、属性值、子节点列表等元信息），每个节点对应一个组件实例，且携带<strong>状态依赖标记</strong>（用于后续更新）。</li>
</ul>
<p><strong>示例</strong>：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 开发者代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct MyComponent </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">State</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;HarmonyOS&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Row</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Hello </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#00009f">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 依赖name状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fontSize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">Button</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Change&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ArkUI&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 触发状态更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li>解析后生成的UI节点树中，<code>Text</code>节点会标记“依赖<code>name</code>状态”，<code>Button</code>节点关联<code>onClick</code>事件回调。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-布局计算measure-layout-draw三段式流程">2. 布局计算：Measure-Layout-Draw三段式流程<a href="#2-布局计算measure-layout-draw三段式流程" class="hash-link" aria-label="Direct link to 2. 布局计算：Measure-Layout-Draw三段式流程" title="Direct link to 2. 布局计算：Measure-Layout-Draw三段式流程">​</a></h4>
<p>UI节点树生成后，布局引擎通过<strong>Measure（测量）-Layout（布局）-Draw（绘制）</strong> 三段式流程计算组件的位置与外观，确保组件按预期显示：</p>
<ul>
<li><strong>Measure（测量）</strong>：从叶子组件到容器组件，递归计算每个组件的期望大小（受父组件约束与自身属性影响）。例如：<code>Text</code>组件根据<code>fontSize</code>和文本长度计算宽度，<code>Column</code>容器根据子组件总高度计算自身高度。</li>
<li><strong>Layout（布局）</strong>：容器组件根据布局规则（如<code>Column</code>的垂直排列、<code>Row</code>的水平排列）分配子组件的位置坐标（x,y）。例如：<code>Column</code>会按子组件顺序从上到下排列，每个子组件的y坐标为前一个子组件的y + 高度。</li>
<li><strong>Draw（绘制）</strong>：生成绘制指令（如绘制文本、背景、边框），传递给渲染引擎。例如：<code>Text</code>组件生成“在（x,y）位置绘制字符串‘Hello’，字体大小16px”的指令。</li>
</ul>
<p><strong>优化点</strong>：</p>
<ul>
<li><strong>增量布局</strong>：仅当组件属性（如<code>width</code>）或父组件布局变化时，才重新执行Measure/Layout，避免全量计算。例如：修改<code>Text</code>的<code>fontSize</code>仅触发该组件的Measure，不影响父容器的Layout。</li>
<li><strong>布局缓存</strong>：对于静态组件（无状态变化），缓存其Measure/Layout结果，避免重复计算。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-状态驱动ui更新的底层逻辑">3. 状态驱动UI更新的底层逻辑<a href="#3-状态驱动ui更新的底层逻辑" class="hash-link" aria-label="Direct link to 3. 状态驱动UI更新的底层逻辑" title="Direct link to 3. 状态驱动UI更新的底层逻辑">​</a></h4>
<p>鸿蒙UI框架的核心优势是“状态变化自动触发UI更新”，其底层依赖<strong>状态管理引擎</strong>的<strong>依赖收集</strong>与<strong>增量更新</strong>机制：</p>
<ul>
<li><strong>步骤1：依赖收集</strong><br>
<!-- -->当组件首次渲染时，状态管理引擎会追踪“哪些UI节点依赖哪些状态变量”。例如：<code>Text(${this.count})</code>会被标记为“依赖<code>count</code>状态”，并将该UI节点加入<code>count</code>的依赖列表。</li>
<li><strong>步骤2：状态变化检测</strong><br>
<!-- -->当状态变量（如<code>@State count</code>）被修改时（如<code>this.count++</code>），状态管理引擎立即检测到变化，并遍历其依赖列表，标记所有关联的UI节点为“待更新”。</li>
<li><strong>步骤3：增量渲染</strong><br>
<!-- -->框架仅对“待更新”的UI节点执行重新计算（Measure/Layout/Draw），而非刷新整个UI树。例如：<code>count</code>变化时，仅重新绘制依赖<code>count</code>的<code>Text</code>组件，父容器<code>Column</code>若未依赖<code>count</code>则不重新布局。</li>
</ul>
<p><strong>示例</strong>：依赖收集与更新触发</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Counter </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token decorator at operator" style="color:#393A34">@</span><span class="token decorator function" style="color:#d73a49">State</span><span class="token plain"> count</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 状态变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Column</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 节点A：依赖count</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Count: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#00009f">this</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">count</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 节点B：不依赖count</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">Text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;固定文本&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">Button</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;+1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">onClick</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 触发count变化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li>首次渲染时，节点A被加入<code>count</code>的依赖列表，节点B无依赖。</li>
<li>点击按钮后，<code>count</code>变化 → 状态引擎触发节点A重新绘制 → 节点B与<code>Column</code>不更新，减少性能开销。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-渲染与合成硬件加速与图层优化">4. 渲染与合成：硬件加速与图层优化<a href="#4-渲染与合成硬件加速与图层优化" class="hash-link" aria-label="Direct link to 4. 渲染与合成：硬件加速与图层优化" title="Direct link to 4. 渲染与合成：硬件加速与图层优化">​</a></h4>
<p>经过布局计算后，渲染指令被传递到引擎层的<strong>渲染引擎</strong>与<strong>合成器</strong>，最终显示到屏幕：</p>
<ul>
<li><strong>硬件加速渲染</strong>：渲染引擎基于OpenGL ES或Vulkan（根据设备能力自动选择），将绘制指令转换为GPU可执行的图形接口，利用硬件加速提升绘制效率（如文本渲染、图片缩放均由GPU处理）。</li>
<li><strong>图层化合成</strong>：复杂UI（如滚动列表、弹窗）会被拆分为多个<strong>图层（Layer）</strong>，每个图层独立渲染，最后由合成器合并图层。例如：滚动列表的可视区域是一个图层，顶部导航栏是另一个图层，滚动时仅更新列表图层，减少整体渲染成本。</li>
<li><strong>离屏渲染（Offscreen Rendering）</strong>：对于需要复杂效果（如阴影、圆角+图片）的组件，先在离屏缓冲区渲染，再合并到主图层，避免重复计算。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="三跨设备适配的底层支持">三、跨设备适配的底层支持<a href="#三跨设备适配的底层支持" class="hash-link" aria-label="Direct link to 三、跨设备适配的底层支持" title="Direct link to 三、跨设备适配的底层支持">​</a></h3>
<p>鸿蒙UI框架支持多设备（手机、平板、手表、车机等），其底层通过<strong>设备抽象层</strong>与<strong>自适应布局算法</strong>实现：</p>
<ul>
<li><strong>设备能力抽象</strong>：设备抽象层统一封装不同设备的屏幕参数（分辨率、DPI）、输入方式（触摸、按键）、渲染能力（GPU支持的特性），框架层无需关心具体设备类型。</li>
<li><strong>自适应布局引擎</strong>：<!-- -->
<ul>
<li>基于<strong>弹性布局（Flex）</strong> 和<strong>网格布局（Grid）</strong> 的基础算法，支持组件在不同尺寸屏幕上自动调整位置与大小。</li>
<li>提供<strong>媒体查询（MediaQuery）</strong> 底层实现：通过监听设备参数变化（如屏幕旋转），动态触发布局重计算，切换适配不同设备的UI样式。</li>
</ul>
</li>
<li><strong>资源适配机制</strong>：框架层自动根据设备特性（如分辨率）加载对应资源（如不同尺寸的图片），底层通过资源索引表快速匹配设备所需资源。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="四性能优化核心技术">四、性能优化核心技术<a href="#四性能优化核心技术" class="hash-link" aria-label="Direct link to 四、性能优化核心技术" title="Direct link to 四、性能优化核心技术">​</a></h3>
<ol>
<li><strong>编译时优化</strong>：ArkTS采用AOT（预编译）方式，将UI代码编译为机器码，减少运行时解析开销；同时在编译阶段静态分析组件依赖，提前标记可能的更新路径。</li>
<li><strong>虚拟节点（Virtual Node）复用</strong>：对于动态列表（如<code>ForEach</code>生成的组件），通过<code>key</code>复用已有虚拟节点，仅更新变化的节点，减少组件创建/销毁成本。</li>
<li><strong>垃圾回收（GC）优化</strong>：UI节点对象采用分代GC策略，频繁创建/销毁的临时节点（如动画帧）放入年轻代，快速回收；长期存在的组件节点放入老年代，减少GC对渲染的阻塞。</li>
<li><strong>事件处理优化</strong>：触摸、点击等事件通过<strong>事件总线</strong>集中分发，优先处理UI关键事件（如滑动），延迟处理非紧急事件（如日志上报），避免事件处理阻塞渲染线程。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="五总结">五、总结<a href="#五总结" class="hash-link" aria-label="Direct link to 五、总结" title="Direct link to 五、总结">​</a></h3>
<p>鸿蒙UI框架的底层实现是<strong>声明式语法解析、状态驱动更新、硬件加速渲染、跨设备抽象</strong>的有机结合：</p>
<ul>
<li>从开发者代码到最终界面，经历“解析→节点生成→布局→渲染→合成”的完整流程，每层通过标准化接口协作。</li>
<li>核心优势在于<strong>增量更新</strong>（仅更新变化的UI部分）与<strong>多设备适配</strong>（统一抽象层+自适应算法），兼顾开发效率与运行性能。</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/frontend/原生客户端/harmony/鸿蒙ui框架原理.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/frontend/原生客户端/harmony/自动发现授权逻辑"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">自动发现授权逻辑</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/frontend/原生客户端/harmony/鸿蒙的响应式机制"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">鸿蒙的响应式机制</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一核心架构分层设计与跨语言协作" class="table-of-contents__link toc-highlight">一、核心架构：分层设计与跨语言协作</a></li><li><a href="#二关键机制从代码到界面的完整流程" class="table-of-contents__link toc-highlight">二、关键机制：从代码到界面的完整流程</a></li><li><a href="#三跨设备适配的底层支持" class="table-of-contents__link toc-highlight">三、跨设备适配的底层支持</a></li><li><a href="#四性能优化核心技术" class="table-of-contents__link toc-highlight">四、性能优化核心技术</a></li><li><a href="#五总结" class="table-of-contents__link toc-highlight">五、总结</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/frontend/intro">前端</a></li><li class="footer__item"><a class="footer__link-item" href="/backend/intro">后端</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">常用网站</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://react.docschina.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">react<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://ant-design.antgroup.com/components/overview-cn" target="_blank" rel="noopener noreferrer" class="footer__link-item">antd<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.react-native.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">react-native<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://docs.taro.zone/docs/" target="_blank" rel="noopener noreferrer" class="footer__link-item">taro<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/" target="_blank" rel="noopener noreferrer" class="footer__link-item">微信小程序<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li><li class="footer__item"><a href="https://github.com/YangShunGit/YangShunGit.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>